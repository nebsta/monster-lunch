#!/usr/bin/python3

import subprocess
import os
import shutil

if os.path.isdir("build"):
  shutil.rmtree("build")

if os.path.exists(".cache"):
  shutil.rmtree(".cache")

if os.path.exists("ml"):
  os.remove("ml")

subprocess.run([
  "conan", 
  "install", 
  ".",
  "--output-folder=build", 
  "--build=missing"#,
  # "--conf:host",
  # "*:tools.graph:skip_binaries=False",
  # "--conf:build",
  # "*:tools.graph:skip_binaries=True"
])

os.chdir("build")

subprocess.run([
    "cmake", 
    "..", 
    "-DCMAKE_TOOLCHAIN_FILE='conan_toolchain.cmake'", 
    "-DCMAKE_BUILD_TYPE=Debug",
    "-DCMAKE_EXPORT_COMPILE_COMMANDS=1"
])

subprocess.run(["cmake", "--build", ".", "--config Debug"])

if os.path.exists("ml"):
  shutil.move("ml", "../ml")
